<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>File Manager</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/navlist.css">
    <script src="../static/js/jquery-1.8.0.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script>	
      $(document).ready(function(){
        if ("WebSocket" in window) {
          ws = new WebSocket("ws://" + document.domain + ":5000/ws");
          ws.onmessage = function (msg) {
            var message = JSON.parse(msg.data);
            var name = message.result.name;
            if (message.result.result == "deleteUserData succeed")
              $("tr#"+name).remove();
          };
        };

        // Bind send button to websocket
        $("button.delete").live("click", function() {
          filename = this.getAttribute("id");
          ws.send(JSON.stringify({'request': 'deleteUserData', 'name': filename}));
        });
		$("button.open").live("click", function() {
          filename = this.getAttribute("id");
		  filetype = $(this).find("p").text();
		  console.log(filetype);
		  switch (filetype){
			case 'regulation':
				window.location = "index?"+'filetype='+filetype+'&filename='+filename;
			  	break;
			case 'simulation':
			  	window.location = "simulation?"+'filetype='+filetype+'&filename='+filename;
			  	break;
			case 'genecircuit':
			  	window.location = "genecircuit?"+'filetype='+filetype+'&filename='+filename;
			  	break;
			case 'plasmid':
			  	window.location = "plasmid?"+'filetype='+filetype+'&filename='+filename;
			  	break;
			case 'protocol':
			  	window.location = "protocol?"+'filetype='+filetype+'&filename='+filename;
			  	break;
		  }
		 
        });
        // Cleanly close websocket when unload window
        window.onbeforeunload = function() {
          ws.onclose = function () {}; // disable onclose handler first
          ws.close()
        };
      });
    </script>
  </head>
  <body>
    <h2>File Manager</h2>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Filename</th>
          <th>Type</th>
          <th>operation</th>
        </tr>
      </thead>
      <tbody>
        {% for item in filelist %}
        <tr id="{{ item.fileName }}">
          <th>{{ item.fileName }}</th>
          <th>{{ item.fileType }}</th>
          <th>
            <button id="{{ item.fileName }}" class="btn open">open<i class="icon-folder-open"></i><p style="display:none;">{{ item.fileType }}</p></button>
            &nbsp
            <button id="{{ item.fileName }}" class="btn delete">delete<i class="icon-trash"></i></button>
          </th>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </body>
</html>
